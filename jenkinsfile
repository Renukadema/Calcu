pipeline {
    agent any
	stages {
	    stage ('clean Workspace') {
		    steps {
			    cleanWs()
			}
		}
		
		stage ('CODE_BUILD') {
		    steps {
			    sh ''' #!/bin/bash
				mvn -f pom.xml clean install
				'''
			}
		}
		stage ("Image  Build - module Module") {
            steps {
			    script {
			
			        sh '''#!/bin/bash
			        //docker login --username=$username --password=$password 
			        docker build -t calculator:$BUILD_NUMBER-DEV -f dockerfile .
				//docker push abdm/abdm/$duomodule:$BUILD_NUMBER-DEV
				//docker rmi abdm/abdm/$duomodule:$BUILD_NUMBER-DEV
												   
					'''
				}
            }
		}		
		stage ("Microservice Deployment ") {
		    steps {
			    script {
					
				//sh "sed -i 's/$duomodule:.*V'/$BUILD_NUMBER-DEV'/g'   /data/K8-Manifests-DEV/API/ABHA/$application/$apiName/$duomodule-deployment.yaml"
				sh "kubectl apply -f calculator-deployment.yaml"
				}
			}
		}
	}
}
