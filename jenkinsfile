pipeline {
    agent any
	stages {
	    stage ('clean Workspace') {
		    steps {
			    cleanWs()
			}
		}
		stage ('GIT-CHECKOUT') {
		    steps {
			    script {
				   git credentialsId: 'jenkins-gitlab-connection', branch: "dev", url: 'https://github.com/fayazdev/Calculator.git'
				}
			}
		}
		stage ('CODE_BUILD') {
		    steps {
			    sh ''' #!/bin/bash
				mvn clean install -U  -s /data/build-tools/maven/conf/settings.xml -DskipTests
				'''
			}
		}
		stage ("Image  Build - module Module") {
            steps {
			    script {
			
			        sh '''#!/bin/bash
			        //docker login --username=$username --password=$password 
			        docker build -t calculator:$BUILD_NUMBER-DEV -f dockerfile .
				//docker push abdm/abdm/$duomodule:$BUILD_NUMBER-DEV
				//docker rmi abdm/abdm/$duomodule:$BUILD_NUMBER-DEV
												   
					'''
				}
            }
		}		
		stage ("Microservice Deployment ") {
		    steps {
			    script {
					
				//sh "sed -i 's/$duomodule:.*V'/$BUILD_NUMBER-DEV'/g'   /data/K8-Manifests-DEV/API/ABHA/$application/$apiName/$duomodule-deployment.yaml"
				sh "kubectl apply -f calculator-deployment.yaml"
				}
			}
		}
	}
